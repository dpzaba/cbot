#!/usr/bin/env bash
set -o errexit

# cbot repo
dir=/home/maxi/cbot/cbot
branch="master"

cd $dir

# fetch any new branches
git fetch --all --quiet
# switch to branch
git checkout $branch --quiet 
# update to state of remote branch
git reset --hard origin/$branch --quiet 

make

# reboot cbot in background
at now << EOF
sleep 1
sudo stop cbot || true && sleep 2 && cp /home/maxi/cbot/cbot/bin/linux-386/cbot /usr/local/bin/cbot && sudo start cbot
EOF

echo "Updated myself! (Wait a few seconds just in case)"
